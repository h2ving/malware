# malware

## Overview

This project demonstrates a file encryption and decryption workflow with the following components:

1. `mw.py` - A malware script that encrypts files within the user’s directory.
2. `decrypt_gen.py` - A generator script that creates a Python decryptor script capable of decrypting files encrypted by mw.py.
3. `mwgen.py` - A utility to create standalone executables for both the malware and decryptor, using PyInstaller.

    **Disclaimer:** This project is for educational purposes only. Unauthorized use of malware is illegal and unethical.

## Table of Contents

1. Project Structure
2. Setup
3. Usage
    Malware Script (mw.py)
    Decryptor Generator Script (decrypt_gen.py)
    Executable Generator (mwgen.py)
4. Script Descriptions
5. Self-Destruction and Cleanup
6. Audit Questions

## Project structure

```bash
.
├── decrypt_gen.py     # Decryptor generator script
├── executables        # Output directory for generated executables
│   └── exegen.py      # Utility script to generate executables
├── mw.py              # Core malware script for file encryption
├── README.md          # Docs
└── requirements.txt   # Dependencies
```

- `mw.py`: The main malware script that encrypts files and leaves a ransom note.
- `decrypt_gen.py`: A generator for creating a decryptor Python script.
- `mwgen.py`: Generates executables for both malware and decryptor scripts.

## Setup

1. Clone the repository: `git clone https://01.kood.tech/git/jpurdepr/malware`
2. Install dependencies: `pip install -r requirements.txt` - may need to install `PyInstaller.__main__` separately.

## Usage

### Malware Script (mw.py)

The malware script, mw.py, encrypts files within the user’s home directory, appending a .pwned extension to each file. It also creates a ransom note with the encryption key on the desktop, prompting the user to contact the attacker to decrypt their files.

To run the malware script:

```bash
python mw.py
```

**Note:** RUN IT ONLY FROM A VIRTUAL MACHINE TO AVOID ENCRYPTING IMPORTANT FILES

### Decryptor Generator Script (decrypt_gen.py)

The decryptor generator script, `decrypt_gen.py`, takes an encryption key as an argument and generates a decryptor script that can be used to decrypt `.pwned` files.

To use `decrypt_gen.py`, provide the encryption key as an argument:

```bash
python decrypt_gen.py <encryption_key>
```

This will generate a Python script named `decryptyourstuffbro.py` in the same directory, which can decrypt the encrypted files.

### Executable Generator (mwgen.py)

The `mwgen.py` script automates the process of generating executables for both `mw.py` (malware) and `decryptyourstuffbro.py` (decryptor). It supports the following flags:

- `--m` or `-malware`: Generate a malware executable from `mw.py`.
- `--d` or `-decrypt`: Generate a decryptor executable from `decrypt_gen.py` using a specified encryption key.
- `--n` or `-name`: (Optional) Specify a custom name for the output executable.

#### Example: Generate Malware Executable

```bash
python mwgen.py --m path/to/mw.py --n MalwareExec
```

This will generate `MalwareExec.exe` to `executables/dist/`

#### Example: Generate Decryptor Executable

```bash
python mwgen.py --d path/to/decrypt_gen.py <encryption_key> --n DecryptorExec
```

This will run the `decrypt_gen.py` to generate a decryption script and build it into an executable `DecryptorExec.exe`.

## Script Descriptions

1. `mw.py` - Malware Script

The `mw.py` script performs the following actions:

- **File Discovery:** Searches for files in the user’s home directory, excluding system and configuration files.
- **File Encryption:** Encrypts the contents of each discovered file using a randomly generated encryption key and renames the file with a `.pwned` extension.
- **Ransom Note Creation:** Writes a ransom note containing the encryption key to the desktop, prompting the user to contact the attacker.
- **Self-Destruction:** After execution, it deletes itself using a batch file.

2. `decrypt_gen.py` - Decryptor Generator

The `decrypt_gen.py` script generates a Python script to decrypt files encrypted by `mw.py`. It:

- Accepts the encryption key as input.
- Creates a Python script (`decryptyourstuffbro.py`) that, when run, will decrypt files with a `.pwned` extension.
- The generated script also includes a self-destruct mechanism to delete itself after successful decryption.

3. `mwgen.py` - Executable Generator

`mwgen.py` simplifies the creation of standalone executables for both the malware and decryptor scripts using `PyInstaller`.

## Self-Destruction and Cleanup

Both `mw.py` and the generated decryptor script include self-destruction mechanisms:

- `mw.py`: Deletes itself after encrypting files and creating the ransom note.
- Generated Decryptor: Deletes itself after decrypting files (and removes the ransom note - mostly for my testing convenience).

The self-destruction is managed by batch scripts that are executed asynchronously to avoid leaving traces.

## Audit Questions

See the [video](https://youtu.be/c6is-mbY31Q) for a demonstration of the encryption and decryption.

### What is ransomware?

Ransomware is a type of malicious software (malware) that encrypts a user’s files or locks them out of their system, making the data inaccessible. Once the data is encrypted, the attacker typically demands a ransom (often in cryptocurrency) in exchange for a decryption key or to restore access. Ransomware attacks are financially motivated and can target individuals, businesses, and critical infrastructure. Common types of ransomware include "locker" ransomware, which locks users out of their devices, and "crypto" ransomware, which encrypts files. Victims face the dilemma of either paying the ransom or losing their data permanently if no backups are available.

### How bypassing Anti-Viruses works?

Bypassing AV can be done by obfuscating the malware, using encryption to hide code, or employing time-wasting techniques that trick AVs into skipping scanning.
Polymorphic or metamorphic malware can dynamically change its appearance to evade signature-based detection.

This project uses only time-wasting techniques to evade detection. Hence the 13/72 Virustotal result (18.05556% security vendors flagged this file as malicious).

### Virustotal check

Malware program:
![virustotalmalwarecheck](images/malwarevt.png)

Decrypting program:
![virustotaldecrypt](images/decryptvt.png)